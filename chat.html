<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Madame Rêve - Interprétation des Rêves</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <link href="https://cdn.jsdelivr.net/npm/@n8n/chat/dist/style.css" rel="stylesheet"/>
<style>
  #n8n-chat {
    --chat--body--background: rgba(255, 255, 255, 0.2);
    --chat--message--user--background: #44405370;
    --chat--message--bot--background: #ffffff78;
  }
    * { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }

    html, body {
      height:100%;
      width:100%;
      display:flex;
      flex-direction:column;
      overflow:hidden;
    }

    header {
      background: rgba(110,142,251,0.9); color:#fff; padding:15px 20px; font-size:1.3rem;
      display:flex; justify-content:space-between; align-items:center; box-shadow:0 2px 15px rgba(0,0,0,.2); z-index:10;
      flex:0 0 auto;
    }
    .logo { display:flex; align-items:center; gap:10px; }
    .logo i { font-size:1.8rem; }
    .user-info { font-size:.9rem; display:flex; align-items:center; gap:10px; }
    .user-avatar { width:35px; height:35px; border-radius:50%; background:#5a7dfa; display:flex; align-items:center; justify-content:center; font-weight:bold; color:#fff; }
    .logout-btn { background:rgba(255,255,255,.2); border:none; color:#fff; padding:8px 15px; border-radius:20px; cursor:pointer; font-size:.9rem; display:flex; align-items:center; gap:6px; }
    .logout-btn:hover { background:rgba(255,255,255,.3); }

    #chat-container { position:relative; flex:1 1 auto; width:100%; height:100%; }
    #chat-container, #n8n-chat { width:100%; height:100%; }

    #n8n-chat {
      background: url("https://i.imgur.com/SLLphqg.jpeg") no-repeat center center;
      background-size: cover;
    }

    #chat-container {
      --chat--header-height: 0;
      --chat--header--padding: 0;
      --chat--header--border-top: none;
      --chat--header--border-bottom: none;
      --chat--heading--font-size: 0;
      --chat--subtitle--line-height: 0;
    }
  
    @media (max-width:768px) {
      header { padding:12px 15px; font-size:1.1rem; }
      .user-info span { display:none; }
      .logo span { font-size:1.1rem; }
    }
  </style>
</head>
<body>

  <header>
    <div class="logo">
      <i class="fas fa-cloud-moon"></i>
      <span>Madame Rêve - Interprète des Rêves</span>
    </div>
    <div class="user-info">
      <div class="user-avatar" id="userAvatar">U</div>
      <span id="userNameDisplay">Utilisateur</span>
      <button class="logout-btn" id="logoutBtn">
        <i class="fas fa-sign-out-alt"></i><span>Déconnexion</span>
      </button>
    </div>
  </header>

  <div id="chat-container">
    <div id="n8n-chat"></div>
  </div>

  <script type="module">
    import { createChat } from 'https://cdn.jsdelivr.net/npm/@n8n/chat/dist/chat.bundle.es.js';

    // Récupération des infos utilisateur
    const userName  = localStorage.getItem('userName')  || 'Utilisateur';
    const userEmail = localStorage.getItem('userEmail') || '';
    document.getElementById('userNameDisplay').textContent = userName;
    document.getElementById('userAvatar').textContent = userName.charAt(0).toUpperCase();

    // Initialisation du chat avec métadonnées (prénom + email envoyés à n8n)
    createChat({
      target: '#n8n-chat',
      mode: 'fullscreen',
      webhookUrl: 'https://monkfish-huge-widely.ngrok-free.app/webhook/44d31a27-b8b0-4b2f-b057-26658158af24/chat',
      metadata: { 
        name: userName, 
        email: userEmail 
      },
      showWelcomeScreen: false,
      initialMessages: [],
      i18n: {
        en: { title: '', subtitle: '', footer: '', getStarted: '', inputPlaceholder: 'Écrivez votre rêve…' }
      }
    });

    // Déconnexion
    document.getElementById('logoutBtn').addEventListener('click', () => {
      if (confirm('Êtes-vous sûr de vouloir vous déconnecter ?')) {
        localStorage.removeItem('userName');
        localStorage.removeItem('userEmail');
        window.location.href = 'index.html';
      }
    });
  </script>
</body>
</html>
