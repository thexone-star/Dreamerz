<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Madame Rêve - Accueil</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          boxShadow: {
            soft: '0 10px 25px rgba(0,0,0,.18)',
          },
          colors: {
            brand: { indigo: '#6e8efb', indigoDark: '#5a7dfa', emerald: '#00a67a' }
          }
        }
      }
    }
  </script>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

  <!-- Fade-in animations -->
  <style>
    .reveal{ opacity:0; transform: translateY(14px); transition: opacity .7s ease, transform .7s ease; }
    .reveal.show{ opacity:1; transform: none; }
  </style>
</head>

<body class="min-h-screen text-gray-900 bg-gradient-to-br from-indigo-900 via-rose-700 to-amber-300">
  <!-- Header -->
  <header class="sticky top-0 z-10 bg-brand-indigo/90 text-white shadow-lg">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-2 font-semibold text-lg">
        <i class="fas fa-cloud-moon"></i>
        <span id="t-site-name">Madame Rêve — Interprète des Rêves</span>
      </div>

      <!-- Lang switch -->
      <div class="flex items-center gap-1 bg-white/20 rounded-full p-1">
        <button id="btn-fr" type="button" class="px-3 py-1.5 rounded-full font-semibold transition text-white bg-white/0">FR</button>
        <button id="btn-en" type="button" class="px-3 py-1.5 rounded-full font-semibold transition text-white/90 hover:text-white">EN</button>
      </div>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 md:px-6">
    <!-- Hero -->
    <section class="reveal text-center text-white mt-8">
      <h1 id="t-hero-title" class="text-2xl md:text-3xl font-extrabold tracking-tight">Explorez le sens de vos rêves — avec douceur et clarté</h1>
      <p id="t-hero-sub" class="opacity-95 mt-2">Entrez dans le chat pour une interprétation bienveillante, ou recevez notre guide sommeil gratuit par email.</p>
      <div class="mt-3 inline-flex items-center gap-2 bg-white/20 rounded-full px-3 py-1 text-sm">
        <i class="fa fa-shield-halved"></i>
        <span id="t-privacy-first">Confidentialité d’abord</span>
      </div>
    </section>

    <!-- Two parallel cards -->
    <section class="grid md:grid-cols-2 gap-5 mt-6">
      <!-- CHAT CARD (code logique conservé) -->
      <section class="reveal bg-white/60 backdrop-blur-md rounded-2xl shadow-soft overflow-hidden">
        <div class="flex items-center gap-2 bg-brand-indigo text-white px-5 py-3 font-semibold">
          <i class="fa fa-comments"></i>
          <span id="t-chat-title">Accéder au chat d’interprétation</span>
        </div>

        <div class="p-5">
          <form onsubmit="goToChat(event)">
            <div class="mb-4">
              <label for="name" id="t-label-firstname" class="block text-sm font-semibold text-gray-800 mb-1">Prénom</label>
              <input class="w-full border border-gray-300 rounded-xl px-3 py-3 outline-none focus:ring-2 focus:ring-brand-indigo/40 focus:border-brand-indigo" type="text" id="name" placeholder="Votre prénom" required>
            </div>

            <div class="mb-4">
              <label for="email" id="t-label-email" class="block text-sm font-semibold text-gray-800 mb-1">Email</label>
              <input class="w-full border border-gray-300 rounded-xl px-3 py-3 outline-none focus:ring-2 focus:ring-brand-indigo/40 focus:border-brand-indigo" type="email" id="email" placeholder="Votre email" required>
            </div>

            <!-- Garder l'ID policyLabel et la structure pour compat -->
            <label id="policyLabel" class="flex items-center gap-2 text-gray-700 mb-3">
              <input type="checkbox" id="policyCheck" class="w-4 h-4 accent-brand-indigo">
              <span id="t-chat-policy" class="text-sm">
                J’accepte la <a href="policies.html" target="_blank" rel="noopener" class="font-semibold text-brand-indigo hover:underline">politique de confidentialité</a>
              </span>
            </label>

            <button type="submit" id="submitBtn" disabled
              class="w-full inline-flex items-center justify-center gap-2 bg-brand-indigo hover:bg-brand-indigoDark text-white font-extrabold rounded-xl px-4 py-3 shadow-lg disabled:opacity-60 disabled:cursor-not-allowed transition">
              <i class="fa fa-door-open"></i>
              <span id="t-btn-enter">Entrer dans le chat</span>
            </button>

            <p id="t-chat-helper" class="text-sm text-gray-600 mt-2">Votre prénom et votre email seront utilisés dans le chat et ne seront pas partagés.</p>
          </form>
        </div>
      </section>

      <!-- EBOOK CARD -->
      <section class="reveal bg-white rounded-2xl shadow-soft overflow-hidden">
        <div class="flex items-center gap-2 bg-brand-emerald text-white px-5 py-3 font-semibold">
          <i class="fa fa-book"></i>
          <span id="t-ebook-title">Recevoir le guide du sommeil (par email)</span>
        </div>

        <div class="p-5">
          <form id="guideForm" onsubmit="getGuide(event)">
            <div class="mb-4">
              <label for="guideEmail" id="t-label-guide-email" class="block text-sm font-semibold text-gray-800 mb-1">Email</label>
              <input class="w-full border border-gray-300 rounded-xl px-3 py-3 outline-none focus:ring-2 focus:ring-emerald-300 focus:border-emerald-400" type="email" id="guideEmail" placeholder="votre@email.com" required>
            </div>

            <div class="mb-4">
              <label for="guideLang" id="t-label-guide-lang" class="block text-sm font-semibold text-gray-800 mb-1">Langue souhaitée</label>
              <select id="guideLang" class="w-full border border-gray-300 rounded-xl px-3 py-3 outline-none focus:ring-2 focus:ring-emerald-300 focus:border-emerald-400">
                <option value="fr">Français (FR)</option>
                <option value="en">English (EN)</option>
              </select>
            </div>

            <div class="flex items-center gap-2 text-gray-700 mb-3">
              <input type="checkbox" id="guidePolicyCheck" class="w-4 h-4 accent-emerald-600">
              <label for="guidePolicyCheck" id="t-ebook-policy" class="text-sm">
                J’accepte la <a href="policies.html" target="_blank" rel="noopener" class="font-semibold text-emerald-700 hover:underline">politique de confidentialité</a>.
              </label>
            </div>

            <button type="submit" id="guideBtn" disabled
              class="w-full inline-flex items-center justify-center gap-2 bg-brand-emerald hover:brightness-95 text-white font-extrabold rounded-xl px-4 py-3 shadow-lg disabled:opacity-60 disabled:cursor-not-allowed transition">
              <i class="fa fa-download"></i>
              <span id="t-btn-guide">Télécharger le guide du sommeil (par email)</span>
            </button>

            <p id="t-ebook-helper" class="text-sm text-gray-600 mt-2">Nous vous enverrons un email contenant un lien de téléchargement sécurisé.</p>
          </form>
        </div>
      </section>
    </section>

    <!-- Bottom sections -->
    <section class="reveal mt-6 bg-white/85 rounded-2xl shadow-soft p-5">
      <h3 class="font-semibold text-lg mb-2"><i class="fa fa-sparkles mr-2"></i><span id="t-benefits-title">Bénéfices</span></h3>
      <ul class="grid sm:grid-cols-2 gap-x-6 gap-y-2 list-disc pl-5">
        <li id="t-b1">Interprétation personnalisée et bienveillante</li>
        <li id="t-b2">Guide sommeil gratuit</li>
        <li id="t-b3">Confidentialité et respect de vos données</li>
        <li id="t-b4">Accès 24/7 depuis votre navigateur</li>
      </ul>
    </section>

    <section class="reveal mt-4 bg-white/85 rounded-2xl shadow-soft p-5">
      <h3 class="font-semibold text-lg mb-2"><i class="fa fa-circle-question mr-2"></i><span id="t-faq-title">Mini-FAQ</span></h3>

      <details class="bg-white border border-gray-200 rounded-xl p-4 mb-2">
        <summary id="t-q1" class="cursor-pointer font-semibold text-gray-900">Est-ce que mes données sont enregistrées ?</summary>
        <p id="t-a1" class="mt-2 text-gray-700">Vous pouvez utiliser le chat sans fournir d’informations sensibles. Si vous renseignez votre email pour le guide, il est stocké uniquement pour l’envoi et les communications liées.</p>
      </details>

      <details class="bg-white border border-gray-200 rounded-xl p-4">
        <summary id="t-q2" class="cursor-pointer font-semibold text-gray-900">Est-ce un avis médical ?</summary>
        <p id="t-a2" class="mt-2 text-gray-700">Non, ce service ne remplace pas un avis médical ou psychologique. En cas de détresse ou d’anxiété, consultez un professionnel.</p>
      </details>
    </section>

    <section class="reveal mt-4 bg-white/85 rounded-2xl shadow-soft p-5">
      <h3 class="font-semibold text-lg mb-2"><i class="fa fa-scale-balanced mr-2"></i><span id="t-legal-title">Mentions légales & RGPD</span></h3>
      <p id="t-legal-text" class="text-gray-800">
        Ce site respecte votre vie privée. Consultez la
        <a href="policies.html" target="_blank" rel="noopener" class="underline font-semibold">politique de confidentialité</a>
        et les
        <a href="mentions-legales.html" target="_blank" rel="noopener" class="underline font-semibold">mentions légales</a>.
      </p>
    </section>

    <footer class="reveal text-center text-white/95 mt-6 mb-10">
      © <span id="t-foot-name">Madame Rêve</span> — <span id="t-foot-note">Interprétations par IA. Ne remplace pas un avis médical.</span>
    </footer>
  </main>

  <!-- i18n + logic (chat intact) -->
  <script>
    // ===== Fade-in on scroll
    const io = new IntersectionObserver((entries)=>{
      entries.forEach(e=>{ if(e.isIntersecting) e.target.classList.add('show'); });
    }, {threshold: .12});
    document.querySelectorAll('.reveal').forEach(el=>io.observe(el));

    // ===== i18n dict
    const T = {
      fr: {
        siteName: "Madame Rêve — Interprète des Rêves",
        heroTitle: "Explorez le sens de vos rêves — avec douceur et clarté",
        heroSub: "Entrez dans le chat pour une interprétation bienveillante, ou recevez notre guide sommeil gratuit par email.",
        privacyFirst: "Confidentialité d’abord",

        chatTitle: "Accéder au chat d’interprétation",
        labelFirstname: "Prénom",
        labelEmail: "Email",
        chatPolicy: 'J’accepte la <a href="policies.html" target="_blank" rel="noopener" class="font-semibold text-brand-indigo hover:underline">politique de confidentialité</a>',
        btnEnter: "Entrer dans le chat",
        chatHelper: "Votre prénom et votre email seront utilisés dans le chat et ne seront pas partagés.",

        ebookTitle: "Recevoir le guide du sommeil (par email)",
        labelGuideEmail: "Email",
        labelGuideLang: "Langue souhaitée",
        ebookPolicy: 'J’accepte la <a href="policies.html" target="_blank" rel="noopener" class="font-semibold text-emerald-700 hover:underline">politique de confidentialité</a>.',
        btnGuide: "Télécharger le guide du sommeil (par email)",
        ebookHelper: "Nous vous enverrons un email contenant un lien de téléchargement sécurisé.",

        benefitsTitle: "Bénéfices",
        b1: "Interprétation personnalisée et bienveillante",
        b2: "Guide sommeil gratuit",
        b3: "Confidentialité et respect de vos données",
        b4: "Accès 24/7 depuis votre navigateur",

        faqTitle: "Mini-FAQ",
        q1: "Est-ce que mes données sont enregistrées ?",
        a1: "Vous pouvez utiliser le chat sans fournir d’informations sensibles. Si vous renseignez votre email pour le guide, il est stocké uniquement pour l’envoi et les communications liées.",
        q2: "Est-ce un avis médical ?",
        a2: "Non, ce service ne remplace pas un avis médical ou psychologique. En cas de détresse ou d’anxiété, consultez un professionnel.",

        legalTitle: "Mentions légales & RGPD",
        legalText: 'Ce site respecte votre vie privée. Consultez la <a href="policies.html" target="_blank" rel="noopener" class="underline font-semibold">politique de confidentialité</a> et les <a href="mentions-legales.html" target="_blank" rel="noopener" class="underline font-semibold">mentions légales</a>.',
        footName: "Madame Rêve",
        footNote: "Interprétations par IA. Ne remplace pas un avis médical."
      },
      en: {
        siteName: "Madame Rêve — Dream Interpreter",
        heroTitle: "Explore the meaning of your dreams—with warmth and clarity",
        heroSub: "Open the chat for a gentle interpretation, or get our free sleep guide by email.",
        privacyFirst: "Privacy first",

        chatTitle: "Access the interpretation chat",
        labelFirstname: "First name",
        labelEmail: "Email",
        chatPolicy: 'I accept the <a href="policies.html" target="_blank" rel="noopener" class="font-semibold underline-offset-2">privacy policy</a>',
        btnEnter: "Enter the chat",
        chatHelper: "Your first name and email are used in the chat and won’t be shared.",

        ebookTitle: "Get the Sleep Guide (by email)",
        labelGuideEmail: "Email",
        labelGuideLang: "Preferred language",
        ebookPolicy: 'I accept the <a href="policies.html" target="_blank" rel="noopener" class="font-semibold underline-offset-2">privacy policy</a>.',
        btnGuide: "Download the Sleep Guide (by email)",
        ebookHelper: "We will send you an email with a secure download link.",

        benefitsTitle: "Benefits",
        b1: "Personalized and empathetic interpretation",
        b2: "Free sleep guide",
        b3: "Privacy & data respect",
        b4: "24/7 access from your browser",

        faqTitle: "Mini-FAQ",
        q1: "Are my data stored?",
        a1: "You can use the chat without sharing sensitive data. If you provide your email for the guide, it’s stored only for sending it and related communications.",
        q2: "Is this medical advice?",
        a2: "No, this service does not replace medical or psychological advice. If you feel distressed, please consult a professional.",

        legalTitle: "Legal & Privacy",
        legalText: 'We respect your privacy. See our <a href="policies.html" target="_blank" rel="noopener" class="underline font-semibold">privacy policy</a> and <a href="mentions-legales.html" target="_blank" rel="noopener" class="underline font-semibold">legal notice</a>.',
        footName: "Madame Rêve",
        footNote: "AI-generated interpretations. Not a medical service."
      }
    };

    const els = {
      siteName: document.getElementById('t-site-name'),
      heroTitle: document.getElementById('t-hero-title'),
      heroSub: document.getElementById('t-hero-sub'),
      privacyFirst: document.getElementById('t-privacy-first'),

      chatTitle: document.getElementById('t-chat-title'),
      labelFirstname: document.getElementById('t-label-firstname'),
      labelEmail: document.getElementById('t-label-email'),
      chatPolicy: document.getElementById('t-chat-policy'),
      btnEnter: document.getElementById('t-btn-enter'),
      chatHelper: document.getElementById('t-chat-helper'),

      ebookTitle: document.getElementById('t-ebook-title'),
      labelGuideEmail: document.getElementById('t-label-guide-email'),
      labelGuideLang: document.getElementById('t-label-guide-lang'),
      ebookPolicy: document.getElementById('t-ebook-policy'),
      btnGuide: document.getElementById('t-btn-guide'),
      ebookHelper: document.getElementById('t-ebook-helper'),

      benefitsTitle: document.getElementById('t-benefits-title'),
      b1: document.getElementById('t-b1'),
      b2: document.getElementById('t-b2'),
      b3: document.getElementById('t-b3'),
      b4: document.getElementById('t-b4'),

      faqTitle: document.getElementById('t-faq-title'),
      q1: document.getElementById('t-q1'),
      a1: document.getElementById('t-a1'),
      q2: document.getElementById('t-q2'),
      a2: document.getElementById('t-a2'),

      legalTitle: document.getElementById('t-legal-title'),
      legalText: document.getElementById('t-legal-text'),
      footName: document.getElementById('t-foot-name'),
      footNote: document.getElementById('t-foot-note'),
    };

    const btnFR = document.getElementById('btn-fr');
    const btnEN = document.getElementById('btn-en');

    function setLang(lang){
      const t = T[lang] || T.fr;

      els.siteName.textContent = t.siteName;
      els.heroTitle.textContent = t.heroTitle;
      els.heroSub.textContent = t.heroSub;
      els.privacyFirst.textContent = t.privacyFirst;

      els.chatTitle.textContent = t.chatTitle;
      els.labelFirstname.textContent = t.labelFirstname;
      els.labelEmail.textContent = t.labelEmail;
      els.btnEnter.textContent = t.btnEnter;
      els.chatHelper.textContent = t.chatHelper;

      els.ebookTitle.textContent = t.ebookTitle;
      els.labelGuideEmail.textContent = t.labelGuideEmail;
      els.labelGuideLang.textContent = t.labelGuideLang;
      els.btnGuide.textContent = t.btnGuide;
      els.ebookHelper.textContent = t.ebookHelper;

      els.benefitsTitle.textContent = t.benefitsTitle;
      els.b1.textContent = t.b1;
      els.b2.textContent = t.b2;
      els.b3.textContent = t.b3;
      els.b4.textContent = t.b4;

      els.faqTitle.textContent = t.faqTitle;
      els.q1.textContent = t.q1;
      els.a1.textContent = t.a1;
      els.q2.textContent = t.q2;
      els.a2.textContent = t.a2;

      els.legalTitle.textContent = t.legalTitle;
      els.legalText.innerHTML = t.legalText;
      els.footName.textContent = t.footName;
      els.footNote.textContent = t.footNote;

      els.chatPolicy.innerHTML = t.chatPolicy;
      els.ebookPolicy.innerHTML = t.ebookPolicy;

      // placeholders
      document.getElementById('name').placeholder = (lang === 'en') ? 'Your first name' : 'Votre prénom';
      document.getElementById('email').placeholder = (lang === 'en') ? 'Your email' : 'Votre email';
      document.getElementById('guideEmail').placeholder = (lang === 'en') ? 'your@email.com' : 'votre@email.com';

      // select default for guide
      document.getElementById('guideLang').value = lang;

      // visual state
      btnFR.classList.toggle('bg-white', lang==='fr');
      btnFR.classList.toggle('text-brand-indigo', lang==='fr');
      btnEN.classList.toggle('bg-white', lang==='en');
      btnEN.classList.toggle('text-brand-indigo', lang==='en');

      localStorage.setItem('lang', lang);
      document.documentElement.lang = lang;
    }

    btnFR.addEventListener('click', () => setLang('fr'));
    btnEN.addEventListener('click', () => setLang('en'));
    setLang(localStorage.getItem('lang') || 'fr');

    // ===== CHAT logic (unchanged)
    const policyCheck = document.getElementById("policyCheck");
    const submitBtn = document.getElementById("submitBtn");
    policyCheck.addEventListener("change", () => { submitBtn.disabled = !policyCheck.checked; });

    function goToChat(e) {
      e.preventDefault();
      if (!policyCheck.checked) {
        alert((localStorage.getItem('lang')==='en') ? "Please accept the privacy policy before continuing." : "Vous devez accepter la politique avant de continuer !");
        return;
      }
      const name = document.getElementById("name").value.trim();
      const email = document.getElementById("email").value.trim();
      localStorage.setItem("userName", name);
      localStorage.setItem("userEmail", email);
      window.location.href = "chat.html";
    }

    // ===== GUIDE logic (webhook → n8n → Brevo)
    const guideCheck = document.getElementById("guidePolicyCheck");
    const guideBtn   = document.getElementById("guideBtn");
    guideCheck.addEventListener("change", () => { guideBtn.disabled = !guideCheck.checked; });

    async function getGuide(e){
      e.preventDefault();
      if (!guideCheck.checked) {
        alert((localStorage.getItem('lang')==='en') ? "Please accept the privacy policy before receiving the guide." : "Merci d'accepter la politique de confidentialité pour recevoir le guide.");
        return;
      }

      const emailGuide = document.getElementById("guideEmail").value.trim();
      const lang = document.getElementById("guideLang").value || (localStorage.getItem('lang') || 'fr');
      const firstName = (document.getElementById("name")?.value || '').trim();

      const labelSending = (lang==='en') ? "Sending..." : "Envoi...";
      const labelDone    = (lang==='en') ? "Sent!" : "Envoyé !";
      const labelBtn     = (lang==='en') ? "Download the Sleep Guide (by email)" : "Télécharger le guide du sommeil (par email)";

      guideBtn.disabled = true;
      const prev = guideBtn.innerHTML;
      guideBtn.innerHTML = `<i class="fa fa-paper-plane"></i> ${labelSending}`;

      try{
        const res = await fetch("https://monkfish-huge-widely.ngrok-free.app/webhook/f6b2f8f3-eea0-4b56-b707-b0e73a2de1d8", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            email: emailGuide,
            firstName,
            consent: true,
            source: "index_ebook_form",
            lang,
            timestamp: new Date().toISOString()
          })
        });

        const data = await res.json().catch(()=>({}));
        if(res.ok){
          guideBtn.innerHTML = `<i class="fa fa-check"></i> ${labelDone}`;
          alert((lang==='en') ? "Thank you! The guide will be sent by email." : "Merci ! Le guide va vous être envoyé par email.");
          setTimeout(()=>{ guideBtn.innerHTML = `<i class="fa fa-download"></i> ${labelBtn}`; guideBtn.disabled = false; }, 1600);
          (document.getElementById("guideForm")).reset();
        }else{
          throw new Error(data?.message || "Request failed");
        }
      }catch(err){
        console.error(err);
        alert((lang==='en') ? "Oops, sending failed. Please try again in a moment." : "Oups, l’envoi a échoué. Réessayez dans un instant.");
        guideBtn.innerHTML = prev;
        guideBtn.disabled = false;
      }
    }
  </script>
</body>
</html>
